# ============================================================
# SNOWFLAKE CORTEX ANALYST SEMANTIC MODEL
# Pizzeria Bella Napoli
# ============================================================
# 
# Upload this file to a Snowflake stage, then create the semantic model:
# 
# CREATE STAGE IF NOT EXISTS PIZZERIA_DEMO.BELLA_NAPOLI.SEMANTIC_MODELS;
# PUT file://pizzeria_semantic_model.yaml @PIZZERIA_DEMO.BELLA_NAPOLI.SEMANTIC_MODELS;
#
# Then use in Cortex Analyst:
# SELECT SNOWFLAKE.CORTEX.COMPLETE(
#     'claude-3-5-sonnet',
#     SNOWFLAKE.CORTEX.ANALYST(
#         '@PIZZERIA_DEMO.BELLA_NAPOLI.SEMANTIC_MODELS/pizzeria_semantic_model.yaml',
#         'What were our top selling pizzas last month?'
#     )
# );
# ============================================================

name: pizzeria_bella_napoli
description: >
  Semantic model for Bella Napoli Pizzeria operations data including 
  sales, orders, customers, menu items, reviews, and inventory. 
  Use this model to answer business questions about restaurant performance,
  customer behavior, popular items, and operational metrics.

# Database context
database: PIZZERIA_DEMO
schema: BELLA_NAPOLI

# Business glossary - define terms users might use
glossary:
  - term: revenue
    definition: Total money collected from orders including tax and tips, minus discounts
    synonyms: [sales, income, earnings]
  
  - term: AOV
    definition: Average Order Value - the average total_amount per order
    synonyms: [average order, avg order value, ticket size, check average]
  
  - term: pizza
    definition: Menu items in the Pizzas category (category_id = 1)
    synonyms: [pie, pies]
  
  - term: bestseller
    definition: Items with the highest quantity sold or revenue generated
    synonyms: [top seller, most popular, best performing]
  
  - term: customer lifetime value
    definition: Total revenue generated by a customer across all their orders
    synonyms: [CLV, LTV, lifetime spend]
  
  - term: repeat customer
    definition: A customer who has placed more than one order
    synonyms: [returning customer, loyal customer]
  
  - term: delivery time
    definition: Time between order placement and delivery completion
    synonyms: [delivery duration, time to deliver]
  
  - term: prep time
    definition: Time between order placement and food being ready
    synonyms: [preparation time, cook time, kitchen time]

# Table definitions
tables:
  # ========== DIMENSION TABLES ==========
  - name: DIM_MENU_ITEM
    description: >
      All menu items including pizzas, appetizers, salads, pasta, desserts, and beverages.
      Contains pricing, cost, dietary information, and availability status.
    columns:
      - name: item_id
        description: Unique identifier for each menu item
        data_type: INT
        is_primary_key: true
      
      - name: item_name
        description: Name of the menu item as displayed to customers
        data_type: VARCHAR
        sample_values: [Margherita, Pepperoni, Supreme, BBQ Chicken, Garlic Knots]
      
      - name: category_id
        description: Foreign key to DIM_CATEGORY (1=Pizzas, 2=Appetizers, 3=Salads, 4=Pasta, 5=Desserts, 6=Beverages)
        data_type: INT
      
      - name: description
        description: Full description of the menu item including ingredients
        data_type: VARCHAR
      
      - name: base_price
        description: Standard price for the item (medium size for pizzas)
        data_type: DECIMAL
        semantic_type: currency
      
      - name: cost_to_make
        description: Cost of ingredients and labor to produce the item
        data_type: DECIMAL
        semantic_type: currency
      
      - name: is_vegetarian
        description: Whether the item is vegetarian-friendly
        data_type: BOOLEAN
      
      - name: is_vegan
        description: Whether the item is vegan-friendly
        data_type: BOOLEAN
      
      - name: is_gluten_free
        description: Whether the item is gluten-free
        data_type: BOOLEAN

  - name: DIM_CATEGORY
    description: Menu categories that group similar items together
    columns:
      - name: category_id
        description: Unique identifier for category
        data_type: INT
        is_primary_key: true
      
      - name: category_name
        description: Name of the category
        data_type: VARCHAR
        sample_values: [Pizzas, Appetizers, Salads, Pasta, Desserts, Beverages]

  - name: DIM_SIZE
    description: Pizza sizes with pricing multipliers
    columns:
      - name: size_id
        description: Unique identifier for size
        data_type: INT
        is_primary_key: true
      
      - name: size_name
        description: Name of the size
        data_type: VARCHAR
        sample_values: [Personal, Small, Medium, Large, X-Large, N/A]
      
      - name: size_inches
        description: Diameter in inches
        data_type: INT
      
      - name: price_multiplier
        description: Multiplier applied to base price (1.0 for medium)
        data_type: DECIMAL

  - name: DIM_CUSTOMER
    description: >
      Customer information including contact details, preferences, and loyalty status.
      Use for customer segmentation and personalization analysis.
    columns:
      - name: customer_id
        description: Unique identifier for each customer
        data_type: INT
        is_primary_key: true
      
      - name: first_name
        description: Customer's first name
        data_type: VARCHAR
      
      - name: last_name
        description: Customer's last name
        data_type: VARCHAR
      
      - name: email
        description: Customer's email address
        data_type: VARCHAR
      
      - name: city
        description: Customer's city
        data_type: VARCHAR
        sample_values: [Austin, Round Rock]
      
      - name: registration_date
        description: Date the customer first registered
        data_type: DATE
      
      - name: loyalty_points
        description: Current loyalty program points balance
        data_type: INT
      
      - name: preferred_order_type
        description: Customer's most common order method
        data_type: VARCHAR
        sample_values: [DELIVERY, PICKUP, DINE_IN]

  - name: DIM_LOCATION
    description: Restaurant location information
    columns:
      - name: location_id
        description: Unique identifier for each location
        data_type: INT
        is_primary_key: true
      
      - name: location_name
        description: Name of the location
        data_type: VARCHAR
        sample_values: [Downtown, Westlake, Round Rock]
      
      - name: city
        description: City where location is situated
        data_type: VARCHAR
      
      - name: seating_capacity
        description: Number of seats available for dine-in
        data_type: INT

  - name: DIM_EMPLOYEE
    description: Employee information including role and compensation
    columns:
      - name: employee_id
        description: Unique identifier for each employee
        data_type: INT
        is_primary_key: true
      
      - name: first_name
        description: Employee's first name
        data_type: VARCHAR
      
      - name: role
        description: Job role/position
        data_type: VARCHAR
        sample_values: [MANAGER, CHEF, CASHIER, DELIVERY_DRIVER]
      
      - name: hourly_rate
        description: Hourly pay rate
        data_type: DECIMAL
        semantic_type: currency

  # ========== FACT TABLES ==========
  - name: FACT_ORDER
    description: >
      Order header information with totals, timestamps, and status.
      Primary fact table for sales analysis. Join with FACT_ORDER_ITEM for line-level detail.
    columns:
      - name: order_id
        description: Unique identifier for each order
        data_type: INT
        is_primary_key: true
      
      - name: customer_id
        description: Foreign key to DIM_CUSTOMER
        data_type: INT
      
      - name: employee_id
        description: Foreign key to DIM_EMPLOYEE (who took the order)
        data_type: INT
      
      - name: location_id
        description: Foreign key to DIM_LOCATION
        data_type: INT
      
      - name: order_timestamp
        description: When the order was placed
        data_type: TIMESTAMP
      
      - name: order_type
        description: How the order was fulfilled
        data_type: VARCHAR
        sample_values: [DELIVERY, PICKUP, DINE_IN]
      
      - name: subtotal
        description: Sum of all line items before tax and tip
        data_type: DECIMAL
        semantic_type: currency
      
      - name: tax_amount
        description: Sales tax collected (8.25%)
        data_type: DECIMAL
        semantic_type: currency
      
      - name: tip_amount
        description: Tip amount for delivery orders
        data_type: DECIMAL
        semantic_type: currency
      
      - name: discount_amount
        description: Any discounts applied
        data_type: DECIMAL
        semantic_type: currency
      
      - name: total_amount
        description: Final order total (subtotal + tax + tip - discount)
        data_type: DECIMAL
        semantic_type: currency
      
      - name: payment_method
        description: How the customer paid
        data_type: VARCHAR
        sample_values: [CASH, CREDIT, DEBIT, MOBILE]
      
      - name: order_status
        description: Current status of the order
        data_type: VARCHAR
        sample_values: [PENDING, PREPARING, READY, DELIVERED, COMPLETED, CANCELLED]

  - name: FACT_ORDER_ITEM
    description: >
      Individual line items within each order. Contains item, size, quantity, and pricing.
      Join with DIM_MENU_ITEM for product details and FACT_ORDER for order context.
    columns:
      - name: order_item_id
        description: Unique identifier for each line item
        data_type: INT
        is_primary_key: true
      
      - name: order_id
        description: Foreign key to FACT_ORDER
        data_type: INT
      
      - name: item_id
        description: Foreign key to DIM_MENU_ITEM
        data_type: INT
      
      - name: size_id
        description: Foreign key to DIM_SIZE (applicable for pizzas)
        data_type: INT
      
      - name: quantity
        description: Number of this item ordered
        data_type: INT
      
      - name: unit_price
        description: Price per unit after size adjustment
        data_type: DECIMAL
        semantic_type: currency
      
      - name: line_total
        description: Total for this line (quantity * unit_price)
        data_type: DECIMAL
        semantic_type: currency

  - name: FACT_REVIEW
    description: >
      Customer reviews and ratings from various sources.
      Contains ratings (1-5 scale) and free-text feedback.
    columns:
      - name: review_id
        description: Unique identifier for each review
        data_type: INT
        is_primary_key: true
      
      - name: order_id
        description: Foreign key to the order being reviewed
        data_type: INT
      
      - name: customer_id
        description: Foreign key to DIM_CUSTOMER
        data_type: INT
      
      - name: location_id
        description: Foreign key to DIM_LOCATION
        data_type: INT
      
      - name: review_date
        description: When the review was submitted
        data_type: TIMESTAMP
      
      - name: overall_rating
        description: Overall satisfaction rating (1-5 stars)
        data_type: INT
        sample_values: [1, 2, 3, 4, 5]
      
      - name: food_rating
        description: Food quality rating (1-5 stars)
        data_type: INT
      
      - name: service_rating
        description: Service quality rating (1-5 stars)
        data_type: INT
      
      - name: delivery_rating
        description: Delivery experience rating (1-5 stars, NULL for non-delivery)
        data_type: INT
      
      - name: review_text
        description: Free-text customer feedback
        data_type: VARCHAR
      
      - name: review_source
        description: Where the review was submitted
        data_type: VARCHAR
        sample_values: [WEBSITE, GOOGLE, YELP, DOORDASH]

  - name: FACT_DAILY_SALES
    description: >
      Pre-aggregated daily sales summary by location.
      Use for trend analysis and forecasting.
    columns:
      - name: sales_date
        description: The date of sales
        data_type: DATE
        is_primary_key: true
      
      - name: location_id
        description: Foreign key to DIM_LOCATION
        data_type: INT
        is_primary_key: true
      
      - name: total_orders
        description: Number of orders for the day
        data_type: INT
      
      - name: total_revenue
        description: Total revenue for the day
        data_type: DECIMAL
        semantic_type: currency
      
      - name: avg_order_value
        description: Average order value for the day
        data_type: DECIMAL
        semantic_type: currency
      
      - name: total_pizzas_sold
        description: Number of pizzas sold
        data_type: INT
      
      - name: is_weekend
        description: Whether the day is Saturday or Sunday
        data_type: BOOLEAN
      
      - name: is_holiday
        description: Whether the day is a recognized holiday
        data_type: BOOLEAN
      
      - name: weather_condition
        description: General weather for the day
        data_type: VARCHAR
        sample_values: [Sunny, Cloudy, Rainy]

# Relationships between tables
relationships:
  - name: order_to_customer
    left_table: FACT_ORDER
    left_column: customer_id
    right_table: DIM_CUSTOMER
    right_column: customer_id
    relationship_type: many_to_one
  
  - name: order_to_location
    left_table: FACT_ORDER
    left_column: location_id
    right_table: DIM_LOCATION
    right_column: location_id
    relationship_type: many_to_one
  
  - name: order_to_employee
    left_table: FACT_ORDER
    left_column: employee_id
    right_table: DIM_EMPLOYEE
    right_column: employee_id
    relationship_type: many_to_one
  
  - name: order_item_to_order
    left_table: FACT_ORDER_ITEM
    left_column: order_id
    right_table: FACT_ORDER
    right_column: order_id
    relationship_type: many_to_one
  
  - name: order_item_to_menu_item
    left_table: FACT_ORDER_ITEM
    left_column: item_id
    right_table: DIM_MENU_ITEM
    right_column: item_id
    relationship_type: many_to_one
  
  - name: order_item_to_size
    left_table: FACT_ORDER_ITEM
    left_column: size_id
    right_table: DIM_SIZE
    right_column: size_id
    relationship_type: many_to_one
  
  - name: menu_item_to_category
    left_table: DIM_MENU_ITEM
    left_column: category_id
    right_table: DIM_CATEGORY
    right_column: category_id
    relationship_type: many_to_one
  
  - name: review_to_order
    left_table: FACT_REVIEW
    left_column: order_id
    right_table: FACT_ORDER
    right_column: order_id
    relationship_type: many_to_one
  
  - name: review_to_customer
    left_table: FACT_REVIEW
    left_column: customer_id
    right_table: DIM_CUSTOMER
    right_column: customer_id
    relationship_type: many_to_one
  
  - name: review_to_location
    left_table: FACT_REVIEW
    left_column: location_id
    right_table: DIM_LOCATION
    right_column: location_id
    relationship_type: many_to_one
  
  - name: daily_sales_to_location
    left_table: FACT_DAILY_SALES
    left_column: location_id
    right_table: DIM_LOCATION
    right_column: location_id
    relationship_type: many_to_one

# Pre-defined metrics for common business questions
metrics:
  - name: total_revenue
    description: Sum of all order totals
    expression: SUM(FACT_ORDER.total_amount)
    tables: [FACT_ORDER]
  
  - name: total_orders
    description: Count of all orders
    expression: COUNT(DISTINCT FACT_ORDER.order_id)
    tables: [FACT_ORDER]
  
  - name: average_order_value
    description: Average revenue per order
    expression: AVG(FACT_ORDER.total_amount)
    tables: [FACT_ORDER]
  
  - name: items_sold
    description: Total quantity of items sold
    expression: SUM(FACT_ORDER_ITEM.quantity)
    tables: [FACT_ORDER_ITEM]
  
  - name: average_rating
    description: Average overall rating from reviews
    expression: AVG(FACT_REVIEW.overall_rating)
    tables: [FACT_REVIEW]
  
  - name: profit_margin
    description: Revenue minus cost for menu items
    expression: SUM(DIM_MENU_ITEM.base_price - DIM_MENU_ITEM.cost_to_make)
    tables: [DIM_MENU_ITEM]

# Sample questions to help guide users
sample_questions:
  - "What are our top 5 selling pizzas this month?"
  - "How does weekend revenue compare to weekday revenue?"
  - "Which location has the highest average order value?"
  - "What's the trend in daily orders over the last 30 days?"
  - "Who are our top 10 customers by lifetime value?"
  - "What percentage of orders are delivery vs pickup vs dine-in?"
  - "What's our average rating by location?"
  - "Which items have the highest profit margin?"
  - "How many new customers did we acquire last month?"
  - "What's the average delivery time by location?"
  - "Show me negative reviews from the past week"
  - "What are our busiest hours of the day?"
  - "Compare sales between Downtown and Westlake locations"
  - "What vegetarian options sell the best?"
